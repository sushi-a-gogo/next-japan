<app-modal [dynamicWidth]="true" [showBackdrop]="false">
  <div class="container">
    @if(busy()) {
    <div class="spinner">
      <mat-spinner
        diameter="40"
        strokeWidth="5"
        class="blue-spin"
      ></mat-spinner>
    </div>
    }
    <div class="content fade-in nx-flex col gap-36" [class.open]="!busy()">
      <header class="nx-flex row al-c jc-sb">
        <span> {{ modeHeaderText() }} </span>
      </header>
      <main class="nx-flex col gap-10">
        @switch(mode()) {
        <!-- sign-in -->
        @case('sign-in') {
        <app-sign-in
          (signIn)="signIn($event)"
          (switchToSignUp)="switchMode('sign-up')"
        />
        }
        <!-- sign-up -->
        @case('sign-up') {
        <app-sign-up-form
          (submit)="choosePlan($event)"
          (switchToSignIn)="switchMode('sign-in')"
        />
        }
        <!-- choose-plan -->
        @case('choose-plan') {
        <app-select-plan [plans]="plans" (select)="selectPlan($event)" />
        }
        <!-- plan-payment -->
        @case('plan-payment') {
        <app-plan-payment
          [user]="newUser()!"
          [plan]="subscriptionPlan()!"
          (completePayment)="completeSignUp()"
          (cancel)="choosePlan(newUser()!)"
        />
        <div class="switchbox nx-flex row al-c gap-5">
          Want to review your plan options?
          <button class="text-button" (click)="choosePlan(newUser()!)">
            Go back
          </button>
        </div>
        } }
        <div>
          <button matButton (click)="goBack.emit()">
            ‚Üê Return to your adventure
          </button>
        </div>
      </main>
    </div>
  </div>
</app-modal>
